<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0D9488">
    <title>Services | UrbanPaintPro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --p: #0D9488; --bg: #F8FAFC; --text: #1E293B; --white: #FFFFFF; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 100px; }

        .header { position: fixed; top: 0; width: 100%; height: 60px; background: white; display: flex; align-items: center; padding: 0 15px; z-index: 100; border-bottom: 1px solid #E2E8F0; }
        .back-btn { font-size: 1.2rem; padding: 10px; cursor: pointer; }
        .header-title { font-weight: 700; font-size: 1.1rem; margin-left: 10px; }

        .tabs-container { 
            position: fixed; top: 60px; width: 100%; background: white; z-index: 99;
            padding: 10px 15px; overflow-x: auto; white-space: nowrap; border-bottom: 1px solid #E2E8F0;
            scrollbar-width: none;
        }
        .tab { 
            display: inline-block; padding: 8px 16px; margin-right: 10px; 
            border-radius: 20px; font-size: 0.85rem; font-weight: 600; 
            background: #F1F5F9; color: #64748B; border: 1px solid transparent; cursor: pointer; transition: 0.2s;
        }
        .tab.active { background: #F0FDFA; color: var(--p); border-color: var(--p); }

        .content { margin-top: 130px; padding: 15px; }

        /* Calculator Styles */
        .calc-card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .selector-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed #E2E8F0; cursor: pointer; }
        .sel-label { font-size: 0.9rem; color: #64748B; font-weight: 600; }
        .sel-value { font-size: 0.95rem; font-weight: 700; color: var(--p); display: flex; align-items: center; gap: 8px; }
        .result-box { background: #F0FDFA; padding: 20px; border-radius: 12px; text-align: center; margin-top: 20px; border: 1px solid #CCFBF1; }
        .total-price { font-size: 2rem; font-weight: 800; color: var(--p); margin: 5px 0; }
        
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-quote { background: var(--p); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; font-size: 0.9rem; }
        .btn-visit { background: white; color: var(--p); border: 2px solid var(--p); padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; font-size: 0.9rem; }

        /* Menu Item Styles */
        .item-card { 
            background: white; padding: 15px; border-radius: 16px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03); border: 1px solid #F1F5F9;
        }
        .add-btn { padding: 6px 15px; background: white; border: 1px solid #CBD5E1; color: var(--p); font-weight: 700; border-radius: 8px; cursor: pointer; }

        /* MODERN POPUP SYSTEM */
        :root {
            --p-light: #14B8A6;
            --p-dark: #0F766E;
            --error: #EF4444;
            --success: #22C55E;
            --warning: #F59E0B;
            --shadow: 0 10px 40px rgba(13, 148, 136, 0.15);
        }

        .toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: white;
            padding: 16px 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 90vw;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.32, 0.72, 0, 1);
            pointer-events: all;
            border-left: 4px solid var(--p);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--error); }
        .toast.warning { border-left-color: var(--warning); }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .toast.success .toast-icon { background: #DCFCE7; color: var(--success); }
        .toast.error .toast-icon { background: #FEE2E2; color: var(--error); }
        .toast.warning .toast-icon { background: #FEF3C7; color: var(--warning); }
        .toast.info .toast-icon { background: #F0FDFA; color: var(--p); }

        .toast-content { flex: 1; }
        .toast-title { font-weight: 700; color: #1E293B; font-size: 0.95rem; margin-bottom: 2px; }
        .toast-message { color: #64748B; font-size: 0.85rem; }

        .toast-close {
            background: none;
            border: none;
            color: #94A3B8;
            cursor: pointer;
            padding: 5px;
            font-size: 1.1rem;
            transition: 0.2s;
        }
        .toast-close:hover { color: #475569; transform: rotate(90deg); }

        /* Bottom Sheet Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(19, 78, 74, 0.6);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            align-items: flex-end;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .bottom-sheet {
            background: white;
            width: 100%;
            max-width: 480px;
            border-radius: 24px 24px 0 0;
            transform: translateY(100%);
            transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        }

        .modal-overlay.active .bottom-sheet {
            transform: translateY(0);
        }

        .sheet-header {
            background: linear-gradient(135deg, var(--p), var(--p-light));
            color: white;
            padding: 20px;
            position: relative;
        }

        .sheet-header::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: rgba(255,255,255,0.4);
            border-radius: 2px;
        }

        .sheet-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sheet-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .sheet-close:hover { background: rgba(255,255,255,0.3); transform: rotate(90deg); }

        .sheet-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .select-option { 
            padding: 18px; 
            border-bottom: 1px solid #F1F5F9; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-weight: 600; 
            cursor: pointer;
            border-radius: 12px;
            margin-bottom: 8px;
            transition: 0.2s;
        }
        .select-option:hover { background: #F0FDFA; }
        .select-option.selected { 
            color: var(--p); 
            background: #F0FDFA; 
            border: 2px solid var(--p);
        }

        /* Cart Bar */
        .cart-bar {
            position: fixed; bottom: 85px; left: 15px; right: 15px;
            background: #1E293B; color: white; padding: 15px;
            border-radius: 12px; display: none; align-items: center; justify-content: space-between;
            z-index: 200; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .cart-bar.active { display: flex; }

        .nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: white; border-top: 1px solid #CCFBF1; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-item { text-align: center; color: #94A3B8; font-size: 0.75rem; font-weight: 700; width: 60px; cursor: pointer; padding: 8px; border-radius: 12px; }
        .nav-item.active { color: var(--p); background: #F0FDFA; }
        .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div class="header">
        <i class="fa-solid fa-arrow-left back-btn" onclick="window.location.href='index.html'"></i>
        <div class="header-title">Services</div>
    </div>

    <div class="tabs-container">
        <div class="tab active" onclick="switchCategory('painting')">Painting</div>
        <div class="tab" onclick="switchCategory('waterproofing')">Waterproofing</div>
        <div class="tab" onclick="switchCategory('electrician')">Electrician</div>
        <div class="tab" onclick="switchCategory('plumber')">Plumber</div>
        <div class="tab" onclick="switchCategory('carpenter')">Carpenter</div>
        <div class="tab" onclick="switchCategory('ac')">AC Repair</div>
        <div class="tab" onclick="switchCategory('cleaning')">Cleaning</div>
        <div class="tab" onclick="switchCategory('pest')">Pest Control</div>
    </div>

    <div class="content" id="mainContent"></div>

    <!-- MODERN SELECTOR SHEET -->
    <div class="modal-overlay" id="sel-overlay" onclick="closeSelector()">
        <div class="bottom-sheet" onclick="event.stopPropagation()">
            <div class="sheet-header">
                <button class="sheet-close" onclick="closeSelector()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
                <div class="sheet-title">
                    <i class="fa-solid fa-list-check"></i>
                    <span id="sel-title">Select Option</span>
                </div>
            </div>
            <div class="sheet-body" id="sel-list"></div>
        </div>
    </div>

    <div class="cart-bar" id="cartBar">
        <div>
            <span id="cartCount" style="font-size:0.8rem; opacity:0.8;">0 items</span>
            <div id="cartTotal" style="font-weight:700; font-size:1.1rem;">₹0</div>
        </div>
        <div onclick="proceedCart()" style="background:var(--p); padding:8px 16px; border-radius:8px; font-weight:700; cursor:pointer;">
            View Cart <i class="fa-solid fa-arrow-right"></i>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item" onclick="window.location.href='index.html'"><i class="fa-solid fa-house"></i><span>Home</span></div>
        <div class="nav-item active" onclick="window.location.href='services.html'"><i class="fa-solid fa-paint-roller"></i><span>Services</span></div>
        <div class="nav-item" onclick="window.location.href='bookings.html'"><i class="fa-solid fa-box-open"></i><span>Orders</span></div>
        <div class="nav-item" onclick="window.location.href='about.html'"><i class="fa-solid fa-user"></i><span>Profile</span></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ==================== DATA LIST ====================
        const calcData = {
            cities: [ 
                {v:'delhi', t:'Delhi'}, 
                {v:'noida', t:'Noida'}, 
                {v:'gurgaon', t:'Gurgaon'},
                {v:'faridabad', t:'Faridabad'},
                {v:'ghaziabad', t:'Ghaziabad'}
            ],
            rooms: [
                {v: 120, t: "1 Wall Small (120 sqft)"},
                {v: 200, t: "1 Wall Highlight (200 sqft)"},
                {v: 450, t: "Master Bedroom (450 sqft)"},
                {v: 1500, t: "1 BHK Flat (1500 sqft)"},
                {v: 2500, t: "2 BHK Flat (2500 sqft)"},
                {v: 3500, t: "3 BHK Flat (3500 sqft)"},
                {v: 4500, t: "4 BHK / Villa (4500 sqft)"}
            ],
            services: [
                {v: 0, t: "Repaint (Same Color)"},
                {v: 5, t: "Repaint + Primer (+₹5)"},
                {v: 12, t: "Fresh Paint + Putty (+₹12)"},
                {v: 20, t: "Full Rental Makeover (+₹20)"}
            ],
            brands: [ 
                {v: 'Asian', t: 'Asian Paints'}, 
                {v: 'Berger', t: 'Berger Paints'}, 
                {v: 'Dulux', t: 'Dulux'}, 
                {v: 'Nerolac', t: 'Nerolac'},
                {v: 'DrFixit', t: 'Dr. Fixit (Waterproofing)'}
            ],
            catalog: {
                "Asian": { 
                    "Interior": [
                        {n:"Tractor Emulsion", p:12}, 
                        {n:"Apcolite Premium", p:22}, 
                        {n:"Royale Luxury", p:28},
                        {n:"Royale Matt", p:32},
                        {n:"Royale Aspira", p:38},
                        {n:"Royale Glitz", p:42}
                    ], 
                    "Exterior": [
                        {n:"Ace Exterior", p:15},
                        {n:"Apex Weatherproof", p:25},
                        {n:"Apex Ultima", p:35},
                        {n:"Ultima Protek", p:55}
                    ],
                    "Waterproofing": [
                        {n:"SmartCare Damp Proof", p:75},
                        {n:"SmartCare Crack Filler", p:45}
                    ]
                },
                "Berger": { 
                    "Interior": [
                        {n:"Bison Emulsion", p:13}, 
                        {n:"Rangoli Total", p:20}, 
                        {n:"Silk Glamor", p:28},
                        {n:"Silk Breathe Easy", p:35}
                    ], 
                    "Exterior": [
                        {n:"Walmasta", p:16},
                        {n:"WeatherCoat Long Life", p:32}
                    ],
                    "Waterproofing": [
                        {n:"Home Shield Dampstop", p:80},
                        {n:"Seal-O-Prime", p:65}
                    ]
                },
                "Dulux": { 
                    "Interior": [
                        {n:"SuperCover", p:16}, 
                        {n:"Velvet Touch", p:32},
                        {n:"Living Diamond", p:40}
                    ], 
                    "Exterior": [
                        {n:"Weathershield", p:28},
                        {n:"Weathershield Powerflex", p:45}
                    ]
                },
                "Nerolac": { 
                    "Interior": [
                        {n:"Beauty Smooth", p:14}, 
                        {n:"Pearls Emulsion", p:24},
                        {n:"Impressions Eco Clean", p:34}
                    ], 
                    "Exterior": [
                        {n:"Excel Mica Marble", p:28},
                        {n:"Suraksha Plus", p:18}
                    ]
                },
                "DrFixit": {
                    "Waterproofing": [
                        {n:"Roofseal (Terrace)", p:85},
                        {n:"Raincoat (Walls)", p:65},
                        {n:"Crack X Paste", p:45},
                        {n:"Dampguard", p:95}
                    ]
                }
            }
        };
        
        const menuData = {
        'waterproofing': [
        {name:'Terrace Waterproofing (Visit)', price:199}, 
        {name:'Bathroom Leakage Check', price:149},
        {name:'Wall Dampness Treatment (1 Wall)', price:1499},
        {name:'Water Tank Waterproofing (500L)', price:999},
        {name:'Crack Filling Service', price:499},
        {name:'Dr. Fixit Coating (Per Sqft)', price:85} 
        ],
        
            'electrician': [
                {name:'Fan Installation', price:89}, 
                {name:'Switch/Socket Repair', price:49}, 
                {name:'Tube Light Install', price:49},
                {name:'MCB Change', price:99},
                {name:'Inverter Installation', price:399},
                {name:'Geyser Installation', price:299},
                {name:'Wiring Fault Check', price:199},
                {name:'Chandelier Install', price:499}
            ],
            'plumber': [
                {name:'Tap Washer Change', price:49}, 
                {name:'New Tap Install', price:89}, 
                {name:'Washbasin Blockage', price:149},
                {name:'Sink Pipe Change', price:99},
                {name:'Toilet Jet Spray', price:129},
                {name:'Water Tank Cleaning (500L)', price:499},
                {name:'Water Tank Cleaning (1000L)', price:799},
                {name:'Shower Installation', price:199}
            ],
            'ac': [
                {name:'AC Service (Split)', price:499}, 
                {name:'AC Service (Window)', price:399}, 
                {name:'AC Install (Split)', price:1499},
                {name:'AC Install (Window)', price:799},
                {name:'Gas Filling (R32)', price:2499},
                {name:'Gas Filling (R22)', price:2199},
                {name:'AC Uninstallation', price:699},
                {name:'PCB Repair (Visit)', price:299}
            ],
            'cleaning': [
                {name:'Full Home Deep Clean (1BHK)', price:1999}, 
                {name:'Full Home Deep Clean (2BHK)', price:2999}, 
                {name:'Full Home Deep Clean (3BHK)', price:3999}, 
                {name:'Bathroom Deep Clean', price:399}, 
                {name:'Kitchen Deep Clean', price:699},
                {name:'Sofa Cleaning (Per Seat)', price:149},
                {name:'Carpet Cleaning', price:599},
                {name:'Fridge Deep Clean', price:199}
            ],
            'carpenter': [
                {name:'Door Lock Repair', price:149}, 
                {name:'Handle Installation', price:89}, 
                {name:'Drill & Hang (Per Hole)', price:29},
                {name:'Curtain Rod Install', price:129},
                {name:'Drawer Channel Fix', price:199},
                {name:'Door Stopper Install', price:49},
                {name:'Furniture Assembly (Small)', price:299},
                {name:'Bed Dismantle/Assemble', price:599}
            ],
            'pest': [
                {name:'Cockroach Control (1BHK)', price:799}, 
                {name:'Cockroach Control (2BHK)', price:999}, 
                {name:'Cockroach Control (3BHK)', price:1199}, 
                {name:'Termite Control (Per Room)', price:1499},
                {name:'Bed Bug Treatment', price:1299},
                {name:'Rat/Mouse Control', price:699}
            ]
        };
        

        // ==================== LOGIC ====================
        let state = {
            category: 'painting',
            paint: { city: 'delhi', room: 120, roomText: '1 Wall', service: 0, serviceText: 'Repaint', brand: 'Asian', cat: 'Interior', prod: 12, prodName: 'Tractor', qty: 1 },
            cart: {}
        };

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const cat = urlParams.get('category') || 'painting';
            switchCategory(cat);
        });

        function switchCategory(cat) {
            state.category = cat;
            
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
                if(t.textContent.toLowerCase().includes(cat)) t.classList.add('active');
            });

            const content = document.getElementById('mainContent');
            const cartBar = document.getElementById('cartBar');

            if(cat === 'painting') {
                cartBar.style.display = 'none';
                renderCalculator(content);
                calculateTotal();
            } else {
                renderMenu(content, cat);
                updateCartBar();
            }
        }

        function renderMenu(container, cat) {
            const items = menuData[cat] || [];
            if(items.length === 0) {
                container.innerHTML = `<div style="text-align:center; color:#94A3B8; padding:40px;">Coming Soon</div>`;
                return;
            }

            container.innerHTML = items.map((item) => {
                const qty = state.cart[item.name]?.qty || 0;
                return `
                    <div class="item-card">
                        <div>
                            <div style="font-weight:700; color:#334155;">${item.name}</div>
                            <div style="font-weight:800; color:var(--p);">₹${item.price}</div>
                        </div>
                        <div>
                            ${qty === 0 ? 
                                `<button class="add-btn" onclick="updateCart('${item.name}', ${item.price}, 1)">ADD +</button>` :
                                `<div style="background:var(--p); color:white; border-radius:8px; display:flex; align-items:center;">
                                    <button onclick="updateCart('${item.name}', ${item.price}, -1)" style="padding:5px 10px; background:transparent; border:none; color:white;">-</button>
                                    <span style="font-weight:700;">${qty}</span>
                                    <button onclick="updateCart('${item.name}', ${item.price}, 1)" style="padding:5px 10px; background:transparent; border:none; color:white;">+</button>
                                </div>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCalculator(container) {
            container.innerHTML = `
                <div class="calc-card">
                    <h3 style="margin-bottom:15px;">Paint Estimator</h3>
                    ${renderRow('city', 'City', state.paint.city.toUpperCase())}
                    ${renderRow('room', 'Area', state.paint.roomText)}
                    ${renderRow('service', 'Condition', state.paint.serviceText)}
                    ${renderRow('brand', 'Brand', state.paint.brand)}
                    ${renderRow('cat', 'Type', state.paint.cat)}
                    ${renderRow('prod', 'Product', state.paint.prodName)}

                    <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0;">
                        <span class="sel-label">Quantity</span>
                        <div style="background:#F1F5F9; border-radius:8px; display:flex; align-items:center;">
                            <button onclick="updatePaintQty(-1)" style="padding:5px 12px; border:none; background:transparent; font-size:1.2rem;">-</button>
                            <span id="paintQty" style="font-weight:700; width:20px; text-align:center;">${state.paint.qty}</span>
                            <button onclick="updatePaintQty(1)" style="padding:5px 12px; border:none; background:transparent; font-size:1.2rem;">+</button>
                        </div>
                    </div>

                    <div class="result-box">
                        <div style="font-size:0.85rem; color:#64748B;">Estimated Cost</div>
                        <div class="total-price" id="calcTotal">₹0</div>
                    </div>

                    <div class="action-grid">
                        <button class="btn-visit" onclick="bookAction('visit')">Book Visit @ ₹49</button>
                        <button class="btn-quote" onclick="bookAction('quote')">Book w/ Quote</button>
                    </div>
                </div>
            `;
        }

        function renderRow(type, label, value) {
            return `
                <div class="selector-row" onclick="openSelector('${type}')">
                    <span class="sel-label">${label}</span>
                    <span class="sel-value">${value} <i class="fa-solid fa-chevron-right" style="font-size:0.7rem;"></i></span>
                </div>
            `;
        }

        let currentContext = '';
        function openSelector(type) {
            currentContext = type;
            const overlay = document.getElementById('sel-overlay');
            overlay.classList.add('active');
            const list = document.getElementById('sel-list');
            
            let options = [];
            if(type === 'city') options = calcData.cities;
            else if(type === 'room') options = calcData.rooms;
            else if(type === 'service') options = calcData.services;
            else if(type === 'brand') options = calcData.brands;
            else if(type === 'cat') options = Object.keys(calcData.catalog[state.paint.brand]).map(c => ({v:c, t:c}));
            else if(type === 'prod') options = calcData.catalog[state.paint.brand][state.paint.cat].map(p => ({v:p.p, t:`${p.n} (₹${p.p}/sqft)`}));

            list.innerHTML = options.map(opt => `
                <div class="select-option ${(state.paint[type] == opt.v || (type=='prod' && state.paint.prod==opt.v)) ? 'selected' : ''}" onclick="handleSelect('${type}', '${opt.v}', '${opt.t}')">
                    <span>${opt.t}</span>
                    ${(state.paint[type] == opt.v || (type=='prod' && state.paint.prod==opt.v)) ? '<i class="fa-solid fa-check" style="color:var(--p);"></i>' : ''}
                </div>
            `).join('');
        }

        function closeSelector() {
            document.getElementById('sel-overlay').classList.remove('active');
        }

        function handleSelect(type, val, text) {
            if(type === 'city') state.paint.city = val;
            if(type === 'room') { state.paint.room = parseInt(val); state.paint.roomText = text; }
            if(type === 'service') { state.paint.service = parseInt(val); state.paint.serviceText = text; }
            if(type === 'brand') { 
                state.paint.brand = val; 
                state.paint.cat = Object.keys(calcData.catalog[val])[0];
                const p = calcData.catalog[val][state.paint.cat][0]; 
                state.paint.prod = p.p; state.paint.prodName = p.n;
            }
            if(type === 'cat') {
                state.paint.cat = val;
                const p = calcData.catalog[state.paint.brand][val][0];
                state.paint.prod = p.p; state.paint.prodName = p.n;
            }
            if(type === 'prod') { state.paint.prod = parseInt(val); state.paint.prodName = text.split(' (')[0]; }

            closeSelector();
            renderCalculator(document.getElementById('mainContent'));
            calculateTotal();
        }

        function updatePaintQty(change) {
            if(state.paint.qty + change > 0) {
                state.paint.qty += change;
                document.getElementById('paintQty').innerText = state.paint.qty;
                calculateTotal();
            }
        }

        function calculateTotal() {
            const base = (state.paint.prod + state.paint.service + 8);
            const total = Math.round(base * state.paint.room * state.paint.qty);
            document.getElementById('calcTotal').innerText = '₹' + total.toLocaleString();
            return total;
        }

        function bookAction(type) {
            const total = calculateTotal();
            const isVisit = type === 'visit';
            const payAmount = isVisit ? 49 : total;

            const orderData = {
                service: isVisit ? "Site Visit Consultation" : `Project (${state.paint.prodName})`,
                total: payAmount,
                type: isVisit ? 'visit' : 'project',
                details: [
                    { name: "Service Type", price: state.paint.serviceText, qty: 1 },
                    { name: "Area", price: state.paint.roomText, qty: 1 },
                    { name: "Product", price: state.paint.prodName, qty: 1 },
                    { name: "Estimated Cost", price: total, qty: 1 } 
                ], 
                date: new Date().toLocaleDateString()
            };

            localStorage.setItem('pendingOrder', JSON.stringify(orderData));
            window.location.href = 'checkout.html';
        }

        function updateCart(name, price, change) {
            if(!state.cart[name]) state.cart[name] = { price, qty: 0 };
            state.cart[name].qty += change;
            if(state.cart[name].qty <= 0) delete state.cart[name];
            
            renderMenu(document.getElementById('mainContent'), state.category);
            updateCartBar();
        }

        function updateCartBar() {
            const items = Object.values(state.cart);
            const count = items.reduce((s, i) => s + i.qty, 0);
            const total = items.reduce((s, i) => s + (i.price * i.qty), 0);
            const bar = document.getElementById('cartBar');
            
            if(count > 0) {
                bar.style.display = 'flex';
                document.getElementById('cartCount').innerText = `${count} items`;
                document.getElementById('cartTotal').innerText = `₹${total}`;
            } else {
                bar.style.display = 'none';
            }
        }

        function proceedCart() {
            const items = Object.entries(state.cart).map(([n, d]) => ({ name: n, ...d }));
            const total = items.reduce((s, i) => s + (i.price * i.qty), 0);
            const orderData = {
                service: `${items[0].name} + ${items.length - 1} more`,
                total: total,
                type: 'service',
                details: items,
                date: new Date().toLocaleDateString()
            };
            localStorage.setItem('pendingOrder', JSON.stringify(orderData));
            window.location.href = 'checkout.html';
        }

        // ==================== TOAST SYSTEM ====================
        function showToast(message, type = 'info', title = '') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fa-circle-check',
                error: 'fa-circle-xmark',
                warning: 'fa-triangle-exclamation',
                info: 'fa-circle-info'
            };
            
            const titles = {
                success: 'Success!',
                error: 'Error!',
                warning: 'Warning!',
                info: 'Information'
            };
            
            toast.innerHTML = `
                <div class="toast-icon"><i class="fa-solid ${icons[type]}"></i></div>
                <div class="toast-content">
                    <div class="toast-title">${title || titles[type]}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            `;
            
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }, 4000);
        }
    </script>
</body>
</html>
