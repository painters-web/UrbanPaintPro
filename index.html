<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UrbanPaintPro | India's #1 Painting App</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root { --p: #4F46E5; --bg: #F8FAFC; --text: #0F172A; --white: #FFFFFF; --success: #22c55e; --error: #ef4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* Splash */
        #splash { position: fixed; inset: 0; background: var(--white); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s; }
        .logo-load { font-size: 2rem; font-weight: 800; color: var(--p); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } }

        /* Header */
        .header { position: absolute; top: 0; width: 100%; height: 60px; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; border-bottom: 1px solid #F1F5F9; }
        .logo { font-weight: 800; font-size: 1.2rem; color: var(--p); }
        .user-icon { width: 32px; height: 32px; border-radius: 50%; background: #EEF2FF; display: flex; align-items: center; justify-content: center; color: var(--p); cursor: pointer; border: 1px solid #E2E8F0; }

        /* Pages */
        .page { height: 100%; padding: 80px 20px 100px; overflow-y: auto; display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards & Inputs */
        .card { background: var(--white); border-radius: 20px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .inp { width: 100%; padding: 14px; background: #F8FAFC; border: 1px solid #E2E8F0; border-radius: 12px; font-weight: 600; font-size: 0.9rem; outline: none; margin-bottom: 10px; transition: 0.3s; }
        .inp:focus { background: var(--white); border-color: var(--p); }
        .btn { width: 100%; padding: 16px; border-radius: 14px; border: none; background: var(--p); color: white; font-weight: 700; font-size: 1rem; cursor: pointer; margin-top: 10px; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn:active { transform: scale(0.98); }
        .btn.outline { background: transparent; border: 2px solid #E2E8F0; color: var(--text); }

        /* Merged Scope Section */
        .merged-section { background: #EEF2FF; border-radius: 16px; padding: 15px; margin-bottom: 15px; border: 1px dashed var(--p); }
        .merged-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .merged-label { font-weight: 700; font-size: 0.85rem; color: var(--p); }

        /* Full Screen Sheets */
        .full-sheet { position: fixed; inset: 0; background: var(--white); z-index: 5000; transform: translateX(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
        .full-sheet.active { transform: translateX(0); }
        .fs-header { padding: 15px 20px; border-bottom: 1px solid #F1F5F9; display: flex; align-items: center; gap: 15px; font-weight: 700; font-size: 1.1rem; }
        .fs-body { flex: 1; overflow-y: auto; padding: 20px; }

        /* Bottom Sheet & Overlay */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; display: none; backdrop-filter: blur(2px); }
        .sheet { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--white); border-radius: 25px 25px 0 0; padding: 25px; z-index: 2001; transform: translateY(100%); transition: 0.4s; }
        .sheet.active { transform: translateY(0); }

        /* Menu Items */
        .menu-item { display: flex; align-items: center; gap: 15px; padding: 18px; border-bottom: 1px solid #F8FAFC; cursor: pointer; transition: 0.2s; }
        .menu-item:active { background: #F8FAFC; }
        .menu-item i { width: 25px; font-size: 1.2rem; }
        .menu-item span { flex: 1; font-weight: 600; font-size: 0.95rem; }

        /* Toggle Switch */
        .switch { position: relative; display: inline-block; width: 45px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--p); }
        input:checked + .slider:before { transform: translateX(21px); }

        /* Tracking Timeline */
        .timeline { position: relative; padding-left: 20px; margin-top: 15px; border-left: 2px solid #E2E8F0; }
        .timeline-item { position: relative; margin-bottom: 20px; padding-left: 10px; }
        .timeline-item::before { content: ''; position: absolute; left: -26px; top: 0; width: 12px; height: 12px; border-radius: 50%; background: #CBD5E1; border: 2px solid white; box-shadow: 0 0 0 2px #E2E8F0; }
        .timeline-item.active::before { background: var(--success); box-shadow: 0 0 0 2px #dcfce7; }
        .timeline-item h5 { font-size: 0.9rem; color: #94A3B8; margin-bottom: 2px; }
        .timeline-item.active h5 { color: var(--text); font-weight: 700; }
        
        /* Chatbot UI */
        .chat-container { display: flex; flex-direction: column; gap: 10px; padding-bottom: 20px; }
        .chat-msg { padding: 12px 16px; border-radius: 12px; max-width: 80%; font-size: 0.9rem; line-height: 1.4; }
        .chat-ai { background: #EEF2FF; color: #1E293B; border-bottom-left-radius: 2px; align-self: flex-start; }
        .chat-user { background: var(--p); color: white; border-bottom-right-radius: 2px; align-self: flex-end; }
        .chat-input { display: flex; gap: 10px; padding: 15px; border-top: 1px solid #F1F5F9; background: white; }

        /* UPI Payment UI */
        .qr-frame { width: 220px; height: 220px; margin: 0 auto 20px; border: 2px solid #e0e0e0; padding: 10px; border-radius: 12px; }
        .qr-frame img { width: 100%; height: 100%; object-fit: contain; }
        .upi-copy-box { background: #eef2ff; padding: 12px; border-radius: 8px; border: 1px dashed var(--p); display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }

        /* Nav */
        .nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: var(--white); border-top: 1px solid #F1F5F9; display: flex; justify-content: space-around; align-items: center; z-index: 1000; padding-bottom: 10px; }
        .nav-item { text-align: center; color: #94A3B8; font-size: 0.75rem; font-weight: 700; width: 60px; }
        .nav-item.active { color: var(--p); transform: translateY(-2px); transition: 0.3s; }
        .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 4px; }

        /* Status Animations */
        .status-screen { position: fixed; inset: 0; background: white; z-index: 6000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        .status-screen.active { display: flex; }
        .icon-circle { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin-bottom: 20px; animation: scaleIn 0.5s; }
        .success-icon { background: #dcfce7; color: var(--success); }
        .error-icon { background: #fee2e2; color: var(--error); }
        @keyframes scaleIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div id="splash"><div class="logo-load">UrbanPaintPro</div></div>

    <div class="header">
        <div class="logo">Urban<span>PaintPro</span></div>
        <div class="user-icon" onclick="nav('account')"><i class="fa-regular fa-user"></i></div>
    </div>

    <div id="home" class="page active">
        <div class="card" style="margin-bottom: 10px; border-bottom: 3px solid var(--p);">
            <h3 style="margin-bottom:15px;" data-lang="work_area"><i class="fa-solid fa-layer-group"></i> Define Work Area</h3>
            <div class="merged-section">
                <div class="merged-header">
                    <span class="merged-label" data-lang="scope">Select Scope</span>
                    <span class="merged-label" data-lang="qty">Unit Count</span>
                </div>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; align-items: center;">
                    <select id="scope-sel" class="inp" style="margin-bottom:0;" onchange="calc()">
                        <option value="1">Full Home Painting</option>
                        <option value="0.3">Partial (1 Rooms)</option>
                        <option value="0.1">Single Wall Accent</option>
                    </select>
                    <div style="display:flex; align-items:center; justify-content:center; gap:10px; background:white; padding:8px; border-radius:12px; border:1px solid #E2E8F0;">
                        <button onclick="updateQty(-1)" style="border:none; background:none; color:var(--p); font-weight:800; cursor:pointer;">-</button>
                        <b id="qty-val" style="min-width:20px; text-align:center;">1</b>
                        <button onclick="updateQty(1)" style="border:none; background:none; color:var(--p); font-weight:800; cursor:pointer;">+</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="background: linear-gradient(135deg, #1E1B4B, #312E81); color: white;">
            <h3 style="margin-bottom:15px; color: #A5B4FC;" data-lang="paint_sel"><i class="fa-solid fa-fill-drip"></i> Paint Selection</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div>
                    <label style="font-size:0.7rem; opacity:0.8;">BRAND</label>
                    <select id="brand-sel" class="inp" style="background:rgba(255,255,255,0.1); color:white; border:none;" onchange="loadCats()">
                        <option value="Asian">Asian Paints</option>
                        <option value="Berger">Berger Paints</option>
                    </select>
                </div>
                <div>
                    <label style="font-size:0.7rem; opacity:0.8;">CATEGORY</label>
                    <select id="cat-sel" class="inp" style="background:rgba(255,255,255,0.1); color:white; border:none;" onchange="loadProds()"></select>
                </div>
            </div>
            <label style="font-size:0.7rem; opacity:0.8;">CHOOSE PRODUCT</label>
            <select id="prod-sel" class="inp" style="background:rgba(255,255,255,0.1); color:white; border:none;" onchange="calc()"></select>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px; border-top:1px solid rgba(255,255,255,0.2); padding-top:15px;">
                <div><small data-lang="est">Estimated Price</small><h2 id="total-price">‚Çπ0</h2></div>
                <button class="btn" style="background:white; color:var(--p); width:auto; padding:8px 15px; font-size:0.8rem;" onclick="genInvoice()" data-lang="bill"><i class="fa-solid fa-file-invoice"></i> Bill</button>
            </div>
        </div>
        <button class="btn" onclick="startBooking()" data-lang="book_visit">Book Inspection Visit</button>
        <p style="text-align:center; font-size:0.8rem; margin-top:10px; color:#64748B;">Charges: ‚Çπ49 (Free for Gold/Platinum)</p>
    </div>

    <div id="orders" class="page">
        <h2 data-lang="projects">My Projects</h2>
        <div id="order-list" style="margin-top:20px;"></div>
    </div>

    <div id="account" class="page">
        <div id="auth-ui" style="text-align:center; padding:40px 0;">
            <img src="https://cdn-icons-png.flaticon.com/512/295/295128.png" width="80" style="margin-bottom:15px;">
            <h2>Welcome Back</h2>
            <p style="color:#64748B;">Login to manage bookings</p>
            <button class="btn" onclick="openFS('fs-login')">Login / Sign Up</button>
        </div>

        <div id="profile-ui" style="display:none;">
            <div style="text-align:center; margin-bottom:30px;">
                <div style="width:80px; height:80px; background:var(--p); color:white; font-size:2rem; font-weight:800; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto;" id="avatar">U</div>
                <h3 id="u-name" style="margin-top:10px;">User</h3>
                <p id="u-email" style="color:#64748B; font-size:0.9rem;"></p>
                <div id="u-plan-badge" style="margin-top:5px;"></div>
            </div>
            
            <div class="card" style="padding:0;">
                <div class="menu-item" onclick="openFS('fs-plans')">
                    <i class="fa-solid fa-crown" style="color: gold;"></i><span>My Plans</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i>
                </div>
                <div class="menu-item" onclick="openFS('fs-bookings')">
                    <i class="fa-solid fa-calendar-check" style="color: var(--p);"></i><span>My Bookings</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i>
                </div>
                <div class="menu-item" onclick="openFS('fs-language')">
                    <i class="fa-solid fa-language" style="color: #8B5CF6;"></i><span data-lang="language">Language / ‡§≠‡§æ‡§∑‡§æ</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i>
                </div>
                <div class="menu-item" onclick="openFS('fs-addresses')">
                    <i class="fa-solid fa-map-location-dot" style="color: #e74c3c;"></i><span>Manage Addresses</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i>
                </div>
                <div class="menu-item" onclick="openFS('fs-settings')">
                    <i class="fa-solid fa-gear" style="color: #64748B;"></i><span>Settings</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i>
                </div>
                <div class="menu-item" onclick="openFS('fs-help')">
                    <i class="fa-solid fa-headset" style="color: #10b981;"></i><span>Help Center</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i>
                </div>
                <div class="menu-item" onclick="openFS('fs-personal')">
                    <i class="fa-solid fa-user-pen"></i><span>Edit Profile</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i>
                </div>
                <div class="menu-item" onclick="openFS('fs-about')">
                    <i class="fa-solid fa-circle-info"></i><span>About App</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i>
                </div>
                <div class="menu-item" onclick="logout()" style="color:red;">
                    <i class="fa-solid fa-power-off" style="color:red"></i><span>Logout</span>
                </div>
            </div>
        </div>
    </div>

    <div class="full-sheet" id="fs-payment">
        <div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-payment')"></i> Scan & Pay</div>
        <div class="fs-body" style="text-align:center;">
            <h2 id="pay-amt-display" style="margin-bottom:5px; color:var(--p);">‚Çπ0</h2>
            <p style="margin-bottom:20px; color:#666;">Pay via PhonePe / Paytm / GPay</p>
            
            <div class="qr-frame">
                <img src="payment_qr.png" alt="Scan QR Code">
            </div>

            <div class="upi-copy-box">
                <span style="font-weight:bold; color:var(--p); font-size:14px;" id="upi-id-text">kingkhan33648@okicici</span>
                <button onclick="copyUPI()" style="background:var(--p); color:white; border:none; padding:5px 10px; border-radius:5px; font-weight:bold; font-size:12px;">COPY</button>
            </div>

            <div style="text-align:left; margin-top:20px;">
                <label style="font-weight:700; color:#444;">Enter UTR / Reference No (12 Digits)</label>
                <input type="number" id="utr-input" class="inp" placeholder="Ex: 345678912345" style="margin-top:5px;">
                <div style="background:#fff3cd; color:#856404; padding:10px; border-radius:8px; font-size:0.8rem; margin-top:5px; border-left:3px solid #ffc107;">
                    ‚ö†Ô∏è Payment ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ö‡§™‡§®‡•á ‡§¨‡•à‡§Ç‡§ï SMS ‡§∏‡•á 12 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ UTR ‡§®‡§Ç‡§¨‡§∞ ‡§Ø‡§π‡§æ‡§Å ‡§ú‡§∞‡•Ç‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç‡•§
                </div>
            </div>

            <button class="btn" onclick="verifyPayment()" style="background:#22c55e; margin-top:20px;">Verify & Submit</button>
        </div>
    </div>

    <div class="full-sheet" id="fs-login">
        <div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-login')"></i> Login</div>
        <div class="fs-body" style="display:flex; flex-direction:column; justify-content:center;">
            <h2 style="margin-bottom:20px;">Welcome Back</h2>
            <input type="email" id="l-email" class="inp" placeholder="Email Address">
            <input type="password" id="l-pass" class="inp" placeholder="Password">
            <div style="text-align:right; margin-bottom:20px;"><span style="color:var(--p); font-size:0.9rem;" onclick="resetPass()">Forgot Password?</span></div>
            <button class="btn" onclick="login()">Log In</button>
            <button class="btn outline" onclick="googleLogin()"><i class="fa-brands fa-google"></i> Google Login</button>
            <p style="text-align:center; margin-top:20px;">Don't have an account? <b style="color:var(--p);" onclick="switchAuth('signup')">Sign Up</b></p>
        </div>
    </div>

    <div class="full-sheet" id="fs-signup">
        <div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-signup')"></i> Create Account</div>
        <div class="fs-body">
            <h2 style="margin-bottom:20px;">New Account</h2>
            <input type="text" id="s-name" class="inp" placeholder="Full Name">
            <input type="email" id="s-email" class="inp" placeholder="Email Address">
            <input type="password" id="s-pass" class="inp" placeholder="Password (Min 6 chars)">
            <button class="btn" onclick="signup()">Create Account</button>
            <p style="text-align:center; margin-top:20px;">Already have an account? <b style="color:var(--p);" onclick="switchAuth('login')">Log In</b></p>
        </div>
    </div>

    <div class="full-sheet" id="fs-language">
        <div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-language')"></i> Select Language</div>
        <div class="fs-body">
            <div class="menu-item" onclick="setLang('en')"><span>üá¨üáß English</span></div>
            <div class="menu-item" onclick="setLang('hi')"><span>üáÆüá≥ Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)</span></div>
            <div class="menu-item" onclick="setLang('hing')"><span>üáÆüá≥ Hinglish</span></div>
            <div class="menu-item" onclick="setLang('mr')"><span>üáÆüá≥ Marathi (‡§Æ‡§∞‡§æ‡§†‡•Ä)</span></div>
            <div class="menu-item" onclick="setLang('bn')"><span>üáÆüá≥ Bengali (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</span></div>
            <div class="menu-item" onclick="setLang('ta')"><span>üáÆüá≥ Tamil (‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç)</span></div>
            <div class="menu-item" onclick="setLang('te')"><span>üáÆüá≥ Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</span></div>
        </div>
    </div>

    <div class="full-sheet" id="fs-chat">
        <div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-chat')"></i> AI Assistant</div>
        <div class="fs-body chat-container" id="chat-box">
            <div class="chat-msg chat-ai">Hello! Ask me about booking, warranty, or pricing.</div>
        </div>
        <div class="chat-input">
            <input type="text" id="chat-in" class="inp" style="margin:0;" placeholder="Type..." onkeypress="handleChat(event)">
            <button class="btn" style="width:50px; margin:0;" onclick="sendChat()"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="full-sheet" id="fs-plans"><div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-plans')"></i> Plans</div><div class="fs-body" id="fs-plans-content"></div></div>
    
    <div class="full-sheet" id="fs-bookings"><div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-bookings')"></i> My Bookings</div><div class="fs-body" id="my-booking-list"></div></div>
    
    <div class="full-sheet" id="fs-help">
        <div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-help')"></i> Help Center</div>
        <div class="fs-body">
            <div class="card" style="padding:0;">
                <div class="menu-item" onclick="openFS('fs-chat')"><i class="fa-solid fa-robot" style="color: #6c5ce7;"></i><span>AI Chat Support</span><i class="fa-solid fa-chevron-right" style="color:#ccc"></i></div>
                <a href="https://wa.me/919711904092" target="_blank" style="text-decoration:none; color:inherit;"><div class="menu-item"><i class="fa-brands fa-whatsapp" style="color: #25D366;"></i><span>WhatsApp Support</span></div></a>
                <a href="mailto:support@urbanpaintpro.in" style="text-decoration:none; color:inherit;"><div class="menu-item"><i class="fa-solid fa-envelope" style="color: #ea4335;"></i><span>Email Support</span></div></a>
            </div>
        </div>
    </div>

    <div class="full-sheet" id="fs-settings"><div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-settings')"></i> Settings</div><div class="fs-body"><div class="card"><div class="menu-item" style="justify-content:space-between;"><span>Notifications</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div></div></div></div>
    <div class="full-sheet" id="fs-personal"><div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-personal')"></i> Edit Profile</div><div class="fs-body"><input type="text" id="edit-name" class="inp" placeholder="Name"><button class="btn" onclick="updateProfile()">Save Changes</button></div></div>
    <div class="full-sheet" id="fs-addresses"><div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-addresses')"></i> Addresses</div><div class="fs-body"><div class="card"><input type="text" id="new-address-input" placeholder="New address..." class="inp"><button onclick="saveNewAddress()" class="btn" style="margin-top:0;">Save</button></div><div id="address-list" class="card" style="padding:0; margin-top:10px;"></div></div></div>
    <div class="full-sheet" id="fs-about"><div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-about')"></i> About</div><div class="fs-body">UrbanPaintPro v3.0</div></div>

    <div id="status-success" class="status-screen"><div class="icon-circle success-icon"><i class="fa-solid fa-check"></i></div><h2 style="color:var(--success)">Success!</h2><p style="margin-top:10px; color:#64748B;">Order confirmed.</p><button class="btn" onclick="window.location.reload()">Done</button></div>
    <div id="status-failed" class="status-screen"><div class="icon-circle error-icon"><i class="fa-solid fa-xmark"></i></div><h2 style="color:var(--error)">Failed!</h2><p style="margin-top:10px; color:#64748B;">Verification Failed.</p><button class="btn" onclick="closeStatus()">Retry</button></div>

    <div class="overlay" id="overlay" onclick="closeSheet()"></div>
    <div class="sheet" id="sheet-book">
        <h3>Confirm Booking</h3>
        <p style="margin-bottom:15px; font-size:0.9rem;" id="visit-charge-display">Visiting Charge: ‚Çπ49</p>
        <button class="btn outline" style="margin-bottom:10px; border-color:var(--p); color:var(--p);" onclick="autoLoc()"><i class="fa-solid fa-location-dot"></i> Auto Detect Location</button>
        <input type="text" id="b-addr" class="inp" placeholder="Full Address">
        <input type="number" id="b-pin" class="inp" placeholder="Pincode (NCR)">
        <button class="btn" onclick="placeOrder()">Pay & Confirm</button>
    </div>

    <div class="sheet" id="sheet-tnc">
        <h3>Terms & Conditions</h3>
        <p style="margin:10px 0; color:#666;">1. Visit charges are non-refundable.<br>2. Final quote after measurement.<br>3. We serve NCR only.</p>
        <div style="display:flex; gap:10px;">
            <button class="btn outline" onclick="closeSheet()">Deny</button>
            <button class="btn" onclick="acceptTNC()">Accept</button>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="nav('home', this)"><i class="fa-solid fa-house"></i>Home</div>
        <div class="nav-item" onclick="nav('orders', this)"><i class="fa-solid fa-box-open"></i>Orders</div>
        <div class="nav-item" onclick="nav('account', this)"><i class="fa-solid fa-user"></i>Account</div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyA2DT2ITLS2LgZF3yEkDA_K9kbPIsfpDig",
          authDomain: "professionalpainters-28488.firebaseapp.com",
          projectId: "professionalpainters-28488",
          databaseURL: "https://professionalpainters-28488-default-rtdb.firebaseio.com",
          storageBucket: "professionalpainters-28488.firebasestorage.app",
          messagingSenderId: "233510965012",
          appId: "1:233510965012:web:ccc02da0f3e86a3b4a7c01"
        };
        try { firebase.initializeApp(firebaseConfig); } catch(e){}
        const auth = firebase.auth();
        const db = firebase.database();

        let currentQty = 1;
        let userPlanDetails = { name: "Free User", status: "none" };
        let currentLang = 'en';
        let pendingPayment = null; // Store details of current payment attempt

        // 7 Languages
        const dict = {
            en: { work_area:"Define Work Area", scope:"Select Scope", qty:"Unit Count", paint_sel:"Paint Selection", est:"Estimated Price", bill:"Download Bill", book_visit:"Book Inspection Visit", projects:"My Projects", language:"Language / ‡§≠‡§æ‡§∑‡§æ" },
            hi: { work_area:"‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç", scope:"‡§¶‡§æ‡§Ø‡§∞‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç", qty:"‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ", paint_sel:"‡§™‡•á‡§Ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç", est:"‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§ï‡•Ä‡§Æ‡§§", bill:"‡§¨‡§ø‡§≤ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç", book_visit:"‡§á‡§Ç‡§∏‡•ç‡§™‡•á‡§ï‡•ç‡§∂‡§® ‡§¨‡•Å‡§ï ‡§ï‡§∞‡•á‡§Ç", projects:"‡§Æ‡•á‡§∞‡•á ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü‡•ç‡§∏", language:"‡§≠‡§æ‡§∑‡§æ / Language" },
            hing: { work_area:"Work Area Select Karo", scope:"Scope Chunen", qty:"Kitne Rooms?", paint_sel:"Paint Select Karo", est:"Lagbhag Price", bill:"Bill Download Karo", book_visit:"Book Now", projects:"Mere Orders", language:"Bhasha Badlein" },
            mr: { work_area:"‡§ï‡§æ‡§Æ‡§æ‡§ö‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ", scope:"‡§µ‡•ç‡§Ø‡§æ‡§™‡•ç‡§§‡•Ä", qty:"‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ", paint_sel:"‡§∞‡§Ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ", est:"‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§ø‡§§ ‡§ï‡§ø‡§Ç‡§Æ‡§§", bill:"‡§¨‡§ø‡§≤ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ", book_visit:"‡§≠‡•á‡§ü ‡§¨‡•Å‡§ï ‡§ï‡§∞‡§æ", projects:"‡§Æ‡§æ‡§ù‡•á ‡§™‡•ç‡§∞‡§ï‡§≤‡•ç‡§™", language:"‡§≠‡§æ‡§∑‡§æ" },
            bn: { work_area:"‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ", scope:"‡¶™‡¶∞‡¶ø‡¶ß‡¶ø", qty:"‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ", paint_sel:"‡¶™‡ßá‡¶á‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®", est:"‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ‡¶¶‡¶æ‡¶Æ", bill:"‡¶¨‡¶ø‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°", book_visit:"‡¶¨‡ßÅ‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®", projects:"‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™", language:"‡§≠‡§æ‡§∑‡§æ" },
            ta: { work_area:"‡Æµ‡Øá‡Æ≤‡Øà ‡Æ™‡Æï‡ØÅ‡Æ§‡Æø‡ÆØ‡Øà ‡Æµ‡Æ∞‡Øà‡ÆØ‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç", scope:"‡Æ®‡Øã‡Æï‡Øç‡Æï‡ÆÆ‡Øç", qty:"‡Æé‡Æ£‡Øç‡Æ£‡Æø‡Æï‡Øç‡Æï‡Øà", paint_sel:"‡Æ™‡ØÜ‡ÆØ‡Æø‡Æ£‡Øç‡Æü‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ", est:"‡ÆÆ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æµ‡Æø‡Æ≤‡Øà", bill:"‡Æ™‡Æø‡Æ≤‡Øç ‡Æ™‡Æ§‡Æø‡Æµ‡Æø‡Æ±‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç", book_visit:"‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ", projects:"‡Æ§‡Æø‡Æü‡Øç‡Æü‡Æô‡Øç‡Æï‡Æ≥‡Øç", language:"‡ÆÆ‡Øä‡Æ¥‡Æø" },
            te: { work_area:"‡∞™‡∞®‡∞ø ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç", scope:"‡∞™‡∞∞‡∞ø‡∞ß‡∞ø", qty:"‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø", paint_sel:"‡∞™‡±Ü‡∞Ø‡∞ø‡∞Ç‡∞ü‡±ç ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï", est:"‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞ß‡∞∞", bill:"‡∞¨‡∞ø‡∞≤‡±ç ‡∞°‡±å‡∞®‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç", book_visit:"‡∞¨‡±Å‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø", projects:"‡∞™‡±ç‡∞∞‡∞æ‡∞ú‡±Ü‡∞ï‡±ç‡∞ü‡±Å‡∞≤‡±Å", language:"‡∞≠‡∞æ‡∞∑" }
        };

        // FULL CATALOG (Expanded)
        const catalog = {
            "Asian": { 
                "Interior": [{n:"Tractor Emulsion", p:12}, {n:"Apcolite Premium", p:20}, {n:"Royale Luxury", p:26}], 
                "Exterior": [{n:"Ace Exterior", p:15}, {n:"Apex Ultima", p:30}],
                "Waterproofing": [{n:"Damp Block", p:80}, {n:"Crack Fill", p:110}],
                "Wood/Metal": [{n:"Enamel", p:18}, {n:"PU Gloss", p:150}]
            },
            "Berger": { 
                "Interior": [{n:"Bison Emulsion", p:13}, {n:"Silk Glamor", p:28}], 
                "Exterior": [{n:"Walmasta", p:16}, {n:"Weathercoat", p:35}],
                "Waterproofing": [{n:"Home Shield", p:85}],
                "Wood/Metal": [{n:"Luxol", p:20}, {n:"Imperia", p:140}]
            }
        };

        window.onload = () => {
            loadCats();
            requestPermissions();
            setTimeout(() => { document.getElementById('splash').style.display='none'; }, 2000);
            auth.onAuthStateChanged(u => {
                if(u) {
                    document.getElementById('auth-ui').style.display='none';
                    document.getElementById('profile-ui').style.display='block';
                    updateUI(u);
                    loadRealData(u.uid);
                } else {
                    document.getElementById('auth-ui').style.display='block';
                    document.getElementById('profile-ui').style.display='none';
                }
            });
        };

        function updateUI(u) {
            document.getElementById('u-name').innerText = u.displayName || 'User';
            document.getElementById('u-email').innerText = u.email;
            document.getElementById('avatar').innerText = u.displayName ? u.displayName[0].toUpperCase() : 'U';
        }

        function requestPermissions() {
            if ("geolocation" in navigator) navigator.geolocation.getCurrentPosition(()=>{}, ()=>{});
            if ("Notification" in window) Notification.requestPermission();
        }

        function setLang(l) {
            currentLang = l;
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if(dict[l][key]) el.innerText = dict[l][key];
            });
            closeFS('fs-language');
        }
        
  // --- REAL TIME TRACKING & DATA ---
        function loadRealData(uid) {
            db.ref('orders').orderByChild('user').equalTo(auth.currentUser.email).on('value', snap => {
                const list = document.getElementById('order-list'); 
                const myList = document.getElementById('my-booking-list');
                if(snap.exists()) {
                    const html = Object.values(snap.val()).reverse().map(o => {
                        const s = o.status;
                        const s1='active', s2=(s==='Accepted'||s==='Completed')?'active':'', s3=(s==='Completed')?'active':'';
                        return `
                        <div class="card" style="border-left: 4px solid ${s==='Completed'?'green':'orange'}; margin-bottom:10px;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                <b>#${o.date.split(',')[0]}</b> <span style="color:var(--p)">${s}</span>
                            </div>
                            <div class="timeline">
                                <div class="timeline-item ${s1}"><h5>Booking Received</h5></div>
                                <div class="timeline-item ${s2}"><h5>Partner Assigned</h5></div>
                                <div class="timeline-item ${s3}"><h5>Work Completed</h5></div>
                            </div>
                            <small style="display:block; margin-top:10px; color:#666;">${o.paint} | ‚Çπ${o.estimate}</small>
                        </div>`;
                    }).join('');
                    list.innerHTML = html;
                    myList.innerHTML = html;
                } else {
                    const empty = '<p style="text-align:center; color:#ccc">No orders yet.</p>';
                    list.innerHTML = empty; myList.innerHTML = empty;
                }
            });

            db.ref('users/' + uid + '/plan').on('value', snap => {
                userPlanDetails = snap.val() || { name: "Free User" };
                const container = document.getElementById('fs-plans-content');
                if(userPlanDetails.name.includes("Member")) {
                    document.getElementById('u-plan-badge').innerHTML = `<span style="background:gold; padding:2px 8px; border-radius:10px; font-size:0.7rem; font-weight:bold;">${userPlanDetails.name}</span>`;
                    container.innerHTML = `<div class="card"><h3>Active: ${userPlanDetails.name}</h3><p>Valid till: ${userPlanDetails.exp}</p></div>`;
                } else {
                    document.getElementById('u-plan-badge').innerHTML = "";
                    container.innerHTML = `
                        <div class="card" style="border:1px solid gold;"><h3>Gold (‚Çπ399)</h3><ul><li>Free Visits</li><li>15% Off</li></ul><button class="btn" onclick="openUPIPayment('Gold Plan', 399, 'plan')">Buy</button></div>
                        <div class="card" style="border:1px solid #0ea5e9;"><h3>Platinum (‚Çπ599)</h3><ul><li>Free Visits</li><li>20% Off</li><li>Priority</li></ul><button class="btn" onclick="openUPIPayment('Platinum Plan', 599, 'plan')">Buy</button></div>`;
                }
            });
            
            db.ref('users/' + uid + '/addresses').on('value', snap => {
                const container = document.getElementById('address-list');
                if(snap.exists()) {
                    let html = ""; snap.forEach(c => { html += `<div class="menu-item"><i class="fa-solid fa-location-dot"></i><span>${c.val()}</span><i class="fa-solid fa-trash" onclick="deleteAddress('${c.key}')"></i></div>`; });
                    container.innerHTML = html;
                } else container.innerHTML = "<small>No addresses.</small>";
            });
        }

        // --- NEW UPI PAYMENT SYSTEM ---
        
        function openUPIPayment(desc, amt, type) {
            // Save details needed for after verification
            pendingPayment = { desc: desc, amt: amt, type: type };
            
            // Show details on Payment Sheet
            document.getElementById('pay-amt-display').innerText = "‚Çπ" + amt;
            document.getElementById('utr-input').value = ""; // Clear old input
            
            // Open Sheet
            openFS('fs-payment');
        }

        function copyUPI() {
            navigator.clipboard.writeText("kingkhan33648@okicici");
            alert("UPI ID Copied!");
        }

        function verifyPayment() {
            const utr = document.getElementById('utr-input').value;
            
            // Simple validation: Ensure UTR is 12 digits
            if(!utr || utr.length < 12) {
                alert("Please enter a valid 12-digit UTR number from your Bank SMS.");
                return;
            }

            // Close Payment Sheet
            closeFS('fs-payment');

            // Process the order based on type
            if(pendingPayment.type === 'booking') {
                confirmOrderDB(pendingPayment.amt, "UPI-" + utr);
            } else if (pendingPayment.type === 'plan') {
                activatePlan(pendingPayment.desc.replace(' Plan', ''), "UPI-" + utr);
            }
        }

        // --- BOOKING ---
        function startBooking() {
            if(!auth.currentUser) return openFS('fs-login');
            document.getElementById('overlay').style.display='block';
            document.getElementById('sheet-tnc').classList.add('active');
        }

        function acceptTNC() {
            document.getElementById('sheet-tnc').classList.remove('active');
            const chargeText = document.getElementById('visit-charge-display');
            chargeText.innerHTML = userPlanDetails.name.includes("Member") ? "Visiting Charge: <strike>‚Çπ49</strike> <b>FREE</b>" : "Visiting Charge: ‚Çπ49";
            document.getElementById('sheet-book').classList.add('active');
        }

        function placeOrder() {
            const addr = document.getElementById('b-addr').value;
            const pin = document.getElementById('b-pin').value;
            if(!addr || !pin) return alert("Enter Details");
            
            // If Member, Free. If Not, Pay 49 via UPI
            if(userPlanDetails.name.includes("Member")) {
                confirmOrderDB(0, "Member_Free");
            } else {
                // Open UPI Sheet instead of Razorpay
                openUPIPayment('Visit Charge', 49, 'booking');
            }
        }

        function confirmOrderDB(amt, payId) {
            db.ref('orders').push({
                user: auth.currentUser.email,
                scope: document.getElementById('scope-sel').options[document.getElementById('scope-sel').selectedIndex].text,
                quantity: currentQty,
                paint: document.getElementById('prod-sel').options[document.getElementById('prod-sel').selectedIndex].text,
                estimate: document.getElementById('total-price').innerText,
                addr: document.getElementById('b-addr').value, pin: document.getElementById('b-pin').value,
                amt: amt, payId: payId, status: "Pending (Verifying UTR)", date: new Date().toLocaleDateString()
            }).then(() => { 
                closeSheet(); 
                document.getElementById('status-success').classList.add('active'); 
            });
        }

        function activatePlan(plan, payId) {
            const exp = new Date(); exp.setFullYear(exp.getFullYear() + 1);
            db.ref('users/' + auth.currentUser.uid + '/plan').set({ name: plan + " Member", exp: exp.toLocaleDateString(), payId: payId }).then(()=> {
                alert("Request Submitted! Plan will be active after UTR verification.");
                closeFS('fs-plans');
            });
        }

        // --- INVOICE & CHAT ---
        function genInvoice() {
            try {
                const doc = new window.jspdf.jsPDF();
                doc.setFontSize(22); doc.setTextColor(79, 70, 229); doc.text("UrbanPaintPro", 15, 20);
                doc.setFontSize(10); doc.setTextColor(100); doc.text("Date: "+new Date().toLocaleDateString(), 15, 30);
                doc.autoTable({ startY: 40, head: [['Item', 'Details']], body: [['Service', document.getElementById('scope-sel').selectedOptions[0].text], ['Paint', document.getElementById('prod-sel').selectedOptions[0].text], ['Est. Cost', document.getElementById('total-price').innerText]] });
                doc.text("Disclaimer: This is a computer generated bill.", 15, doc.lastAutoTable.finalY + 10);
                doc.text("Professional visit at home required for final quote.", 15, doc.lastAutoTable.finalY + 16);
                doc.save("Invoice.pdf");
            } catch(e) { alert("Error generating bill"); }
        }

        function handleChat(e) { if(e.key === 'Enter') sendChat(); }
        function sendChat() {
            const inp = document.getElementById('chat-in'); const box = document.getElementById('chat-box');
            if(!inp.value) return;
            box.innerHTML += `<div class="chat-msg chat-user">${inp.value}</div>`;
            setTimeout(() => { box.innerHTML += `<div class="chat-msg chat-ai">I can help with Pricing & Booking.</div>`; box.scrollTop = box.scrollHeight; }, 800);
            inp.value = "";
        }

        // --- UTILS ---
        function updateQty(v) { currentQty = Math.max(1, currentQty + v); document.getElementById('qty-val').innerText = currentQty; calc(); }
        function loadCats() { const b = document.getElementById('brand-sel').value; const cats = Object.keys(catalog[b]); document.getElementById('cat-sel').innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join(''); loadProds(); }
        function loadProds() { const b = document.getElementById('brand-sel').value; const c = document.getElementById('cat-sel').value; const prods = catalog[b][c]; document.getElementById('prod-sel').innerHTML = prods.map(p => `<option value="${p.p}">${p.n}</option>`).join(''); calc(); }
        
        // FIXED CALC FORMULA
        function calc() {
            const p = parseFloat(document.getElementById('prod-sel').value) || 0;
            const scope = parseFloat(document.getElementById('scope-sel').value) || 1;
            // Area: Wall=120, Room=450, Home=1500
            let area = 1500;
            if(scope === 0.3) area = 450;
            if(scope === 0.1) area = 120;
            const total = Math.round((p + 8) * currentQty * area); 
            document.getElementById('total-price').innerText = "‚Çπ" + total.toLocaleString('en-IN');
        }
        function autoLoc() { if(navigator.geolocation) { navigator.geolocation.getCurrentPosition(p => { document.getElementById('b-addr').value = "GPS: "+p.coords.latitude.toFixed(4); }); } }
        function nav(p, e) { document.querySelectorAll('.page').forEach(x => x.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active')); document.getElementById(p).classList.add('active'); if(e) e.classList.add('active'); else document.querySelector(`.nav-item[onclick*='${p}']`)?.classList.add('active'); }
        function openFS(id) { document.getElementById(id).classList.add('active'); }
        function closeFS(id) { document.getElementById(id).classList.remove('active'); }
        function closeSheet() { document.getElementById('overlay').style.display='none'; document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active')); }
        function closeStatus() { document.querySelectorAll('.status-screen').forEach(s => s.classList.remove('active')); }
        
        function login() { const e = document.getElementById('l-email').value, p = document.getElementById('l-pass').value; if(e) auth.signInWithEmailAndPassword(e,p).then(()=>closeFS('fs-login')).catch(e=>alert(e.message)); }
        function googleLogin() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(()=>closeFS('fs-login')); }
        function signup() { const n = document.getElementById('s-name').value, e = document.getElementById('s-email').value, p = document.getElementById('s-pass').value; if(n && e) auth.createUserWithEmailAndPassword(e,p).then(c => { c.user.updateProfile({displayName: n}); db.ref('users/'+c.user.uid).set({ profile: {name: n, email: e} }); closeFS('fs-signup'); }); }
        function switchAuth(type) { document.getElementById('fs-login').classList.remove('active'); document.getElementById('fs-signup').classList.remove('active'); document.getElementById('fs-'+type).classList.add('active'); }
        function resetPass() { const e = document.getElementById('l-email').value; if(e) auth.sendPasswordResetEmail(e).then(()=>alert("Link sent!")); else alert("Enter Email"); }
        function logout() { auth.signOut().then(()=>location.reload()); }
        function saveNewAddress() { const v=document.getElementById('new-address-input').value; if(v) db.ref('users/'+auth.currentUser.uid+'/addresses').push(v); }
        function deleteAddress(k) { if(confirm("Delete?")) db.ref('users/'+auth.currentUser.uid+'/addresses/'+k).remove(); }
        function updateProfile() { const n = document.getElementById('edit-name').value; if(n && auth.currentUser) { auth.currentUser.updateProfile({displayName: n}); alert("Updated!"); closeFS('fs-personal'); } }
    </script>
</body>
</html>
