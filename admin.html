<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UrbanPaintPro | Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #F1F5F9; margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 5px solid #ccc; }
        .card.Pending { border-left-color: orange; }
        .card.Accepted { border-left-color: #3b82f6; }
        .card.Completed { border-left-color: #22c55e; }
        
        .btn { padding: 5px 10px; cursor: pointer; border: none; border-radius: 5px; color: white; font-weight: bold; margin-right: 5px; }
        .btn-accept { background: #3b82f6; }
        .btn-complete { background: #22c55e; }
        .btn-delete { background: #ef4444; }
        h3 { margin: 0 0 5px 0; }
        p { margin: 2px 0; font-size: 0.9rem; color: #64748B; }
    </style>
</head>
<body>

    <div class="header">
        <h2>Admin Dashboard</h2>
        <button onclick="refresh()" style="padding:10px;">Refresh</button>
    </div>

    <div id="loading">Loading Orders...</div>
    <div id="orders-container"></div>

    <script>
        // --- 1. FIREBASE CONFIG (SAME AS INDEX.HTML) ---
        const firebaseConfig = {
          apiKey: "AIzaSyA2DT2ITLS2LgZF3yEkDA_K9kbPIsfpDig",
          authDomain: "professionalpainters-28488.firebaseapp.com",
          projectId: "professionalpainters-28488",
          // ðŸ‘‡ SINGAPORE URL (IMPORTANT)
          databaseURL: "https://professionalpainters-28488-default-rtdb.asia-southeast1.firebasedatabase.app",
          storageBucket: "professionalpainters-28488.firebasestorage.app",
          messagingSenderId: "233510965012",
          appId: "1:233510965012:web:ccc02da0f3e86a3b4a7c01"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- 2. LOAD ALL ORDERS ---
        const container = document.getElementById('orders-container');
        
        db.ref('orders').on('value', (snapshot) => {
            document.getElementById('loading').style.display = 'none';
            container.innerHTML = '';
            
            if (snapshot.exists()) {
                const orders = snapshot.val();
                // Loop through all orders
                Object.keys(orders).reverse().forEach(key => {
                    const o = orders[key];
                    const html = `
                        <div class="card ${o.status}">
                            <div style="display:flex; justify-content:space-between;">
                                <h3>â‚¹${o.estimate} <small>(${o.amt > 0 ? 'Paid' : 'Free'})</small></h3>
                                <span>${o.date}</span>
                            </div>
                            <p><b>User:</b> ${o.user}</p>
                            <p><b>Service:</b> ${o.scope} | ${o.quantity} Units</p>
                            <p><b>Product:</b> ${o.paint}</p>
                            <p><b>Address:</b> ${o.addr} (${o.pin})</p>
                            <p><b>Current Status:</b> <span style="font-weight:bold">${o.status}</span></p>
                            <div style="margin-top:10px;">
                                <button class="btn btn-accept" onclick="updateStatus('${key}', 'Accepted')">Mark Assigned</button>
                                <button class="btn btn-complete" onclick="updateStatus('${key}', 'Completed')">Mark Completed</button>
                                <button class="btn btn-delete" onclick="deleteOrder('${key}')">Delete</button>
                            </div>
                        </div>
                    `;
                    container.innerHTML += html;
                });
            } else {
                container.innerHTML = '<p>No orders found.</p>';
            }
        });

        // --- 3. ACTIONS ---
        function updateStatus(key, status) {
            if(confirm("Change status to " + status + "?")) {
                db.ref('orders/' + key).update({ status: status });
            }
        }

        function deleteOrder(key) {
            if(confirm("Are you sure you want to delete this order?")) {
                db.ref('orders/' + key).remove();
            }
        }

        function refresh() { window.location.reload(); }
    </script>
</body>
</html>
