<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | UrbanPaintPro</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- PRO ADMIN TABLE STYLES --- */
        .badge { padding: 5px 12px; border-radius: 50px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .b-pending { background: #FEF3C7; color: #D97706; }
        .b-accepted { background: #DBEAFE; color: #2563EB; }
        .b-completed { background: #D1FAE5; color: #059669; }
        .b-cancelled { background: #FEE2E2; color: #DC2626; }
        
        /* Partner Column Style */
        .p-cell { display: flex; align-items: center; gap: 8px; }
        .p-avatar { width: 25px; height: 25px; border-radius: 50%; object-fit: cover; border: 1px solid #ddd; }
        .p-info { display: flex; flex-direction: column; }
        .p-name { font-weight: 600; font-size: 13px; color: #374151; }
        .p-contact { font-size: 10px; color: #6B7280; }
        
        /* Action Buttons */
        .btn-view { background: #EEF2FF; color: #4F46E5; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .btn-view:hover { background: #4F46E5; color: white; }
        .btn-del { background: #FEF2F2; color: #EF4444; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; }
        .btn-del:hover { background: #EF4444; color: white; }
        
        /* --- ORDER DETAILS MODAL (POPUP) --- */
        .modal-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
        display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-box {
        background: white; width: 500px; max-width: 90%; border-radius: 16px;
        padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); position: relative;
        animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        
        .detail-row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 12px 0; }
        .detail-label { color: #64748B; font-size: 13px; }
        .detail-val { font-weight: 600; color: #1E293B; text-align: right; }
        
    </style>
</head>
<body>

<div id="admin-login">
    <div class="login-box">
        <h2 style="color: var(--p); margin-bottom: 10px;">Admin Access</h2>
        <p style="color: gray; font-size: 0.9rem;">Secure Dashboard Login</p>
        <input type="password" id="admin-pass" class="u-inp" placeholder="Enter Admin Password">
        <button class="u-btn" onclick="checkAdmin()">Unlock Dashboard</button>
    </div>
</div>

<div class="sidebar">
    <span class="logo">UrbanManager</span>
    <div class="menu-item active"><i class="fa-solid fa-grid-2"></i> Dashboard</div>
    <div class="menu-item"><i class="fa-solid fa-users"></i> Customers</div>
    <div class="menu-item"><i class="fa-solid fa-money-bill-wave"></i> Revenue</div>
    <div class="menu-item"><i class="fa-solid fa-gear"></i> Settings</div>
</div>

<div class="main-content">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <h2>Project Overview</h2>
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="width:10px; height:10px; background:var(--green); border-radius:50%;"></div>
            <span style="font-weight:700; color:var(--green);">Live Database</span>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div><div class="stat-num" id="total-orders">0</div><div class="stat-label">Total Bookings</div></div>
            <i class="fa-solid fa-clipboard-list stat-icon"></i>
        </div>
        <div class="stat-card">
            <div><div class="stat-num" id="total-revenue">â‚¹0</div><div class="stat-label">Total Revenue</div></div>
            <i class="fa-solid fa-indian-rupee-sign stat-icon" style="color:var(--green)"></i>
        </div>
        <div class="stat-card">
            <div><div class="stat-num" id="pending-orders">0</div><div class="stat-label">Pending Actions</div></div>
            <i class="fa-solid fa-clock stat-icon" style="color:orange"></i>
        </div>
    </div>

    <div class="table-container">
        <h3 style="margin-bottom:20px;">Recent Bookings</h3>
        <table>
            <thead>
                <tr>
                    <th>ORDER ID</th>
                    <th>CUSTOMER</th>
                    <th>LOCATION</th>
                    <th>AMOUNT</th>
                    <th>STATUS</th>
                    <th>ACTIONS</th>
                </tr>
            </thead>
            <tbody id="admin-table">
                </tbody>
        </table>
    </div>
</div>
     <div id="order-modal" class="modal-overlay">
     <div class="modal-box">
     <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
     <h3 style="font-size:18px;">Order Details</h3>
     <button onclick="closeModal()" style="border:none; background:none; font-size:20px; cursor:pointer;">&times;</button>
     </div>
     <div id="modal-content"></div>
     <div style="margin-top: 20px; display: flex; gap: 10px;">
     <button onclick="closeModal()" style="flex:1; padding:12px; border:1px solid #ddd; background:white; border-radius:8px;">Close</button>
     <button id="modal-call-btn" style="flex:1; padding:12px; background:#4F46E5; color:white; border:none; border-radius:8px;">Call Customer</button>
     </div>
     </div>
     </div>
    
<script>
    // --- SAME FIREBASE CONFIG (Copy from main file) ---
    // --- FIREBASE CONFIGURATION (Singapore Region) ---
    const firebaseConfig = {
    apiKey: "AIzaSyCmqBL6a0muExq2qBsSR6M3C_8AyXcJ2k8",
    authDomain: "urban-paint-pro.firebaseapp.com",
    // Notice: 'asia-southeast1' likha hai, jo Singapore ka code hai
    databaseURL: "https://urban-paint-pro-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "urban-paint-pro",
    storageBucket: "urban-paint-pro.firebasestorage.app",
    messagingSenderId: "929763117480",
    appId: "1:929763117480:web:560057baeb12672078b59d"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    

    // --- ADMIN SECURITY ---
    function checkAdmin() {
        const pass = document.getElementById('admin-pass').value;
        if(pass === "Mahi9717") {
            document.getElementById('admin-login').style.display = 'none';
            loadDashboard();
        } else {
            alert("Wrong Password! Access Denied.");
        }
    }

    // --- LOAD DATA ---
    function loadDashboard() {
        // --- LOAD DATA (Replaces old loadDashboard) ---
        function loadDashboard() {
        db.ref('orders').on('value', snap => {
        const table = document.getElementById('admin-table'); 
        table.innerHTML = ""; 
        
        if(snap.exists()) {
        const orders = Object.values(snap.val()).reverse(); 
        
        orders.forEach(o => {
        // 1. Status Badge Logic
        let badgeClass = 'b-pending';
        if(o.status === 'Accepted') badgeClass = 'b-accepted';
        if(o.status === 'Completed') badgeClass = 'b-completed';
        if(o.status === 'Cancelled') badgeClass = 'b-cancelled';
        
        // 2. Partner Column Logic
        let partnerHtml = `<span style="color:#EF4444; font-size:12px; font-weight:600;">âš  Pending</span>`;
        if (o.partnerName) {
        const pPhoto = o.partnerPhoto || "https://cdn-icons-png.flaticon.com/512/149/149071.png";
        partnerHtml = `
        <div class="p-cell">
        <img src="${pPhoto}" class="p-avatar">
        <div class="p-info">
        <span class="p-name">${o.partnerName}</span>
        <a href="tel:${o.partnerPhone}" class="p-contact">ðŸ“ž Call</a>
        </div>
        </div>`;
        }
        
        // 3. Row Generation
        const row = `
        <tr style="border-bottom: 1px solid #f1f5f9;">
        <td>#${o.date ? o.date.split(',')[0] : 'ID'}</td>
        <td>
        <div style="font-weight:700; color:#334155;">${o.user ? o.user.split('@')[0] : 'User'}</div>
        <div style="font-size:11px; color:#94A3B8;">${o.service}</div>
        </td>
        <td>${partnerHtml}</td>
        <td style="font-weight:700; color:#4F46E5;">â‚¹${o.amt || '0'}</td>
        <td><span class="badge ${badgeClass}">${o.status}</span></td>
        <td style="display:flex; gap:10px;">
        <button class="btn-view" onclick='viewOrder(${JSON.stringify(o)})'><i class="fa-solid fa-eye"></i></button>
        <button class="btn-del" onclick="deleteOrder('${o.id}')"><i class="fa-solid fa-trash"></i></button>
        </td>
        </tr>
        `;
        table.innerHTML += row;
        });
        } else {
        table.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:20px;">No Orders Found</td></tr>`;
        }
        });
        }
        
        // --- MODAL FUNCTIONS ---
        function viewOrder(order) {
        const modal = document.getElementById('order-modal');
        const content = document.getElementById('modal-content');
        const callBtn = document.getElementById('modal-call-btn');
        
        const partnerInfo = order.partnerName 
        ? `<span style="color:#10B981;"><b>${order.partnerName}</b> (Assigned)</span>` 
        : `<span style="color:#EF4444;">Not Assigned Yet</span>`;
        
        content.innerHTML = `
        <div class="detail-row"><span class="detail-label">Service</span> <span class="detail-val">${order.service}</span></div>
        <div class="detail-row"><span class="detail-label">Scope</span> <span class="detail-val">${order.scope} (Qty: ${order.quantity})</span></div>
        <div class="detail-row"><span class="detail-label">Amount</span> <span class="detail-val">â‚¹${order.amt}</span></div>
        <div class="detail-row"><span class="detail-label">Status</span> <span class="detail-val">${order.status}</span></div>
        <div class="detail-row"><span class="detail-label">Address</span> <span class="detail-val" style="font-size:12px; text-align:right;">${order.addr}<br>Pin: ${order.pin}</span></div>
        <div class="detail-row"><span class="detail-label">Partner</span> <span class="detail-val">${partnerInfo}</span></div>
        <div class="detail-row"><span class="detail-label">Payment ID</span> <span class="detail-val" style="color:#4F46E5; font-size:11px;">${order.payId || 'N/A'}</span></div>
        `;
        
        // Call Button Set
        callBtn.onclick = function() { window.location.href = `tel:${order.user}`; }; 
        modal.style.display = 'flex';
        }
        
        function closeModal() { document.getElementById('order-modal').style.display = 'none'; }
        
        function deleteOrder(id) {
        if(confirm("Permanently delete this order?")) {
        // Note: Ensure your data uses 'id' as the key. If using push(), key is automatic.
        // If deleting fails, try db.ref('orders/'+id).remove();
        db.ref('orders/'+id).remove();
        }
        }
        // ... Upar deleteOrder wala function khatam hua ...
        
        // âœ… 1. DASHBOARD LOAD KARNE KI COMMAND (Bahut Zaroori)
        // Agar ye line nahi likhoge to Table khaali dikhegi
        window.onload = function() {
        loadDashboard();
        };
        
        </script> </body>   </html>   ```
       
