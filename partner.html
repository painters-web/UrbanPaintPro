                                            <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Partner App | Urban Paint Pro</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --p: #10B981; --bg: #111827; --card: #1F2937; --text: #F9FAFB; --gray: #9CA3AF; --error: #EF4444; --warn: #F59E0B; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* Login UI */
        #login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; flex-direction: column; justify-content: center; padding: 30px; overflow-y: auto; }
        .login-inp { width: 100%; padding: 14px; background: #374151; border: 1px solid #4B5563; border-radius: 10px; color: white; margin-bottom: 12px; outline: none; }
        .login-btn { width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 12px; font-weight: 700; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1rem; }
        .google-btn { background: white; color: #333; }
        .email-btn { background: var(--p); color: white; }
        .divider { text-align: center; margin: 20px 0; color: var(--gray); font-size: 0.8rem; position: relative; }
        .divider::before, .divider::after { content: ""; position: absolute; top: 50%; width: 40%; height: 1px; background: #374151; }
        .divider::before { left: 0; } .divider::after { right: 0; }
        .toggle-text { text-align: center; color: var(--gray); font-size: 0.9rem; cursor: pointer; margin-top: 10px; }

        /* App UI */
        #app-screen { display: none; } 
        .header { padding: 15px 20px; background: rgba(31, 41, 55, 0.95); position: sticky; top: 0; z-index: 50; border-bottom: 1px solid #374151; display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(10px); }
        .logo { font-size: 1.2rem; font-weight: 800; color: var(--p); }
        .rating-badge { background: #374151; color: #FBBF24; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; }

        .section { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }

        .card { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 16px; border: 1px solid #374151; position: relative; }
        .inp { width: 100%; padding: 12px; background: #111827; border: 1px solid #374151; border-radius: 8px; color: white; outline: none; margin-bottom: 15px; }
        .label { font-size: 0.8rem; color: var(--gray); margin-bottom: 5px; display: block; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--p); color: white; }
        .btn-start { background: #3B82F6; color: white; } /* Blue for Start */
        .btn-complete { background: #8B5CF6; color: white; } /* Purple for Complete */
        
        /* Menu Style */
        .menu-list { background: var(--card); border-radius: 16px; overflow: hidden; border: 1px solid #374151; margin-bottom: 20px; }
        .menu-item { padding: 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #374151; cursor: pointer; transition: 0.2s; color: white; }
        .menu-item:last-child { border-bottom: none; }
        .menu-item:active { background: #374151; }
        .menu-left { display: flex; align-items: center; gap: 15px; }
        .icon-box { width: 35px; height: 35px; background: #374151; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--p); }

        /* Full Sheets */
        .full-sheet { position: fixed; inset: 0; background: var(--bg); z-index: 3000; transform: translateX(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
        .full-sheet.active { transform: translateX(0); }
        .fs-header { padding: 15px 20px; border-bottom: 1px solid #374151; display: flex; align-items: center; gap: 15px; font-weight: 700; font-size: 1.1rem; background: var(--card); }
        .fs-body { padding: 20px; overflow-y: auto; flex: 1; }

        /* Nav */
        .nav { position: fixed; bottom: 0; width: 100%; background: #1F2937; border-top: 1px solid #374151; display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; }
        .nav-item { text-align: center; color: var(--gray); font-size: 0.75rem; cursor: pointer; width: 60px; }
        .nav-item.active { color: var(--p); }
        .nav-item i { font-size: 1.4rem; display: block; margin-bottom: 4px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div style="text-align:center; margin-bottom:30px;">
            <i class="fa-solid fa-paint-roller" style="font-size:3rem; color:var(--p);"></i>
            <h1 style="margin-top:10px;">UrbanPartner</h1>
            <p style="color:var(--gray);">Partner Login Portal</p>
        </div>
        <button class="login-btn google-btn" onclick="loginGoogle()">
            <i class="fa-brands fa-google"></i> Continue with Google
        </button>
        <div class="divider">OR USE EMAIL</div>
        <div id="email-form">
            <input type="text" id="l-name" class="login-inp" placeholder="Full Name (For New Users)" style="display:none;">
            <input type="email" id="l-email" class="login-inp" placeholder="Email Address">
            <input type="password" id="l-pass" class="login-inp" placeholder="Password (Min 6 chars)">
            <div style="text-align:right; margin-bottom:15px;">
                <span onclick="resetPass()" style="color:var(--p); font-size:0.85rem; cursor:pointer;">Forgot Password?</span>
            </div>
            <button class="login-btn email-btn" onclick="handleEmailAuth()" id="auth-btn">LOGIN</button>
            <div class="toggle-text" onclick="toggleAuthMode()">
                New Partner? <b style="color:var(--p)">Register Here</b>
            </div>
        </div>
    </div>

    <div id="app-screen">
        <div class="header">
            <div class="logo">URBAN<span style="color:white">PARTNER</span></div>
            <div class="rating-badge"><i class="fa-solid fa-star"></i> <span id="header-rating">--</span></div>
        </div>

        <div id="tab-home" class="section active">
            <h2 style="margin-bottom:15px;">New Opportunities</h2>
            <div id="new-leads-container"></div>
        </div>

        <div id="tab-jobs" class="section">
            <h2 style="margin-bottom:15px;">My Jobs</h2>
            <div id="my-leads-container"></div>
        </div>

        <div id="tab-earnings" class="section">
            <h2 style="margin-bottom:15px;">My Wallet</h2>
            <div class="card" style="text-align:center;">
                <p style="color:var(--gray);">Total Earnings</p>
                <div style="font-size:2.5rem; font-weight:800; color:var(--p);" id="total-earn">₹0</div>
                <div style="margin-top:10px; font-size:0.9rem; color:var(--gray);">
                    Next Payout: <b>Monday</b>
                </div>
            </div>
        </div>

        <div id="tab-account" class="section">
            <div style="text-align:center; margin-bottom:25px; margin-top:10px;">
                <img id="p-photo" src="" style="width:90px; height:90px; border-radius:50%; border:3px solid var(--p); object-fit:cover;">
                <h2 id="display-name" style="margin-top:10px; font-size:1.3rem;">Partner</h2>
                <div id="verification-badge" style="color:var(--gray); font-size:0.9rem; margin-top:5px;"></div>
            </div>

            <div class="menu-list">
                <div class="menu-item" onclick="openFS('fs-kyc')">
                    <div class="menu-left">
                        <div class="icon-box"><i class="fa-solid fa-id-card"></i></div>
                        <div><div style="font-weight:600;">KYC Verification</div><div style="font-size:0.75rem; color:var(--gray);">Documents & Bank</div></div>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:var(--gray)"></i>
                </div>

                <div class="menu-item" onclick="openFS('fs-ratings')">
                    <div class="menu-left">
                        <div class="icon-box" style="color:#FBBF24"><i class="fa-solid fa-star"></i></div>
                        <div><div style="font-weight:600;">My Ratings</div><div style="font-size:0.75rem; color:var(--gray);">Reviews & Feedback</div></div>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:var(--gray)"></i>
                </div>

                <div class="menu-item" onclick="alert('Help Center Coming Soon')">
                    <div class="menu-left">
                        <div class="icon-box" style="color:#60A5FA"><i class="fa-solid fa-headset"></i></div>
                        <span>Help Center</span>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:var(--gray)"></i>
                </div>
                
                <div class="menu-item" onclick="alert('Urban Paint Pro v1.0')">
                    <div class="menu-left">
                        <div class="icon-box" style="color:#A78BFA"><i class="fa-solid fa-circle-info"></i></div>
                        <span>About App</span>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:var(--gray)"></i>
                </div>

                <div class="menu-item" onclick="alert('Terms & Conditions applied.')">
                    <div class="menu-left">
                        <div class="icon-box" style="color:#F472B6"><i class="fa-solid fa-file-contract"></i></div>
                        <span>Terms & Conditions</span>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="color:var(--gray)"></i>
                </div>
            </div>

            <button class="btn" style="background:#EF4444; margin-top:10px;" onclick="firebase.auth().signOut()">Logout Account</button>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="switchTab('home', this)"><i class="fa-solid fa-house"></i> Leads</div>
            <div class="nav-item" onclick="switchTab('jobs', this)"><i class="fa-solid fa-briefcase"></i> Jobs</div>
            <div class="nav-item" onclick="switchTab('earnings', this)"><i class="fa-solid fa-wallet"></i> Wallet</div>
            <div class="nav-item" onclick="switchTab('account', this)"><i class="fa-solid fa-user"></i> Account</div>
        </div>
    </div>

    <div id="fs-kyc" class="full-sheet">
        <div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-kyc')"></i> Verification</div>
        <div class="fs-body">
            <div class="card">
                <h4 style="margin-bottom:15px; color:white;">Personal Details</h4>
                <label class="label">Full Name</label><input type="text" id="inp-name" class="inp">
                <label class="label">Phone Number</label><input type="number" id="inp-phone" class="inp">
                
                <h4 style="margin:20px 0 15px; color:white;">Identity</h4>
                <label class="label">Aadhaar Number</label><input type="number" id="inp-aadhaar" class="inp">
                <label class="label">PAN Number</label><input type="text" id="inp-pan" class="inp">
                
                <h4 style="margin:20px 0 15px; color:white;">Bank (For Payouts)</h4>
                <label class="label">Account Number</label><input type="number" id="inp-bank" class="inp">
                <label class="label">IFSC Code</label><input type="text" id="inp-ifsc" class="inp">
                
                <button id="btn-save-kyc" class="btn btn-primary" onclick="submitKYC()">SUBMIT FOR VERIFICATION</button>
            </div>
        </div>
    </div>

    <div id="fs-ratings" class="full-sheet">
        <div class="fs-header"><i class="fa-solid fa-arrow-left" onclick="closeFS('fs-ratings')"></i> My Ratings</div>
        <div class="fs-body">
            <div class="card" style="text-align:center;">
                <div style="font-size:3rem; font-weight:800; color:#FBBF24;">5.0</div>
                <div style="color:var(--gray);">Overall Rating</div>
            </div>
            <h4 style="margin:20px 0 10px;">Recent Reviews</h4>
            <div class="card">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <b>Amit Kumar</b> <span style="color:#FBBF24">★★★★★</span>
                </div>
                <p style="font-size:0.9rem; color:var(--gray);">Great work, very professional!</p>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCmqBL6a0muExq2qBsSR6M3C_8AyXcJ2k8",
            authDomain: "urban-paint-pro.firebaseapp.com",
            databaseURL: "https://urban-paint-pro-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "urban-paint-pro",
            storageBucket: "urban-paint-pro.firebasestorage.app",
            messagingSenderId: "929763117480",
            appId: "1:929763117480:web:560057baeb12672078b59d"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        let currentUser = null;
        let partnerData = null; 
        let isRegistering = false;

        // --- AUTH & LOGIN ---
        function toggleAuthMode() {
            isRegistering = !isRegistering;
            document.getElementById('l-name').style.display = isRegistering ? 'block' : 'none';
            document.getElementById('auth-btn').innerText = isRegistering ? "CREATE ACCOUNT" : "LOGIN";
            document.querySelector('.toggle-text').innerHTML = isRegistering ? 'Already have account? <b style="color:var(--p)">Login Here</b>' : 'New Partner? <b style="color:var(--p)">Register Here</b>';
        }

        function handleEmailAuth() {
            const email = document.getElementById('l-email').value;
            const pass = document.getElementById('l-pass').value;
            const name = document.getElementById('l-name').value;
            if(!email || !pass) return alert("Enter details");

            if(isRegistering) {
                if(!name) return alert("Enter Name");
                auth.createUserWithEmailAndPassword(email, pass).then(res => {
                    res.user.updateProfile({displayName: name});
                    // Save Initial Data
                    db.ref('partners/' + res.user.uid).set({
                        name: name, email: email, rating: 5.0, earnings: 0, kycStatus: "pending"
                    }).then(() => location.reload());
                }).catch(e => alert(e.message));
            } else {
                auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
            }
        }
        
        function loginGoogle() { auth.signInWithPopup(provider).catch(e => alert(e.message)); }
        function resetPass() { auth.sendPasswordResetEmail(document.getElementById('l-email').value).then(()=>alert("Sent!")).catch(e=>alert(e.message)); }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-screen').style.display = 'block';
                currentUser = user;
                document.getElementById('display-name').innerText = user.displayName;
                if(user.photoURL) document.getElementById('p-photo').src = user.photoURL;
                loadProfile(user.uid);
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-screen').style.display = 'none';
            }
        });

        // --- LOAD DATA ---
        function loadProfile(uid) {
            db.ref('partners/' + uid).on('value', snap => {
                if(snap.exists()) {
                    partnerData = snap.val();
                    document.getElementById('header-rating').innerText = partnerData.rating || "5.0";
                    document.getElementById('total-earn').innerText = "₹" + (partnerData.earnings || 0);
                    
                    // UI Badge Update
                    const badge = document.getElementById('verification-badge');
                    if(partnerData.kycStatus === 'verified') badge.innerHTML = '<span style="color:#10B981"><i class="fa-solid fa-check-circle"></i> Verified Partner</span>';
                    else if(partnerData.kycStatus === 'rejected') badge.innerHTML = '<span style="color:#EF4444"><i class="fa-solid fa-circle-xmark"></i> KYC Rejected</span>';
                    else badge.innerHTML = '<span style="color:#F59E0B"><i class="fa-solid fa-clock"></i> Verification Pending</span>';

                    // Prefill
                    if(partnerData.name) document.getElementById('inp-name').value = partnerData.name;
                    if(partnerData.phone) document.getElementById('inp-phone').value = partnerData.phone;
                    if(partnerData.aadhaar) document.getElementById('inp-aadhaar').value = partnerData.aadhaar;
                } else {
                    alert("Account not found! Please Register.");
                    auth.signOut().then(()=>location.reload());
                }
                startListening();
            });
        }

        // --- LEADS & JOBS LOGIC ---
        function startListening() {
            db.ref('orders').on('value', snap => {
                const newCont = document.getElementById('new-leads-container');
                const myCont = document.getElementById('my-leads-container');
                newCont.innerHTML = ""; myCont.innerHTML = "";

                if (snap.exists()) {
                    Object.entries(snap.val()).reverse().forEach(([key, order]) => {
                        
                        // 1. MY JOBS (Accepted)
                        if (order.partnerId === currentUser.uid) {
                            let actionBtn = "";
                            
                            if (order.status === "Accepted") {
                                // Start Job Button (OTP Mangega)
                                actionBtn = `<button class="btn btn-start" onclick="startJob('${key}')">START WORK (ENTER OTP)</button>`;
                            } else if (order.status === "Work Started") {
                                // Complete Job Button
                                actionBtn = `<button class="btn btn-complete" onclick="completeJob('${key}')">MARK COMPLETE</button>`;
                            } else if (order.status === "Completed") {
                                actionBtn = `<button class="btn" disabled style="opacity:0.6; background:green">COMPLETED</button>`;
                            }

                            myCont.innerHTML += `
                                <div class="card" style="border-left:4px solid #F59E0B">
                                    <h3 style="color:white">${order.scope}</h3>
                                    <p style="color:var(--gray)">${order.addr}</p>
                                    <div style="display:flex; gap:10px; margin-top:10px;">
                                        <a href="tel:${order.user}" class="btn" style="background:#374151; width:50px;"><i class="fa-solid fa-phone"></i></a>
                                        ${actionBtn}
                                    </div>
                                </div>`;
                        }
                        
                        // 2. NEW LEADS (Visible to ALL, but Accept needs KYC)
                        else if (order.status && order.status.includes("Pending")) {
                            newCont.innerHTML += `
                                <div class="card">
                                    <div style="display:flex; justify-content:space-between;">
                                        <h3 style="color:white">${order.scope}</h3>
                                        <b style="color:var(--p)">${order.estimate}</b>
                                    </div>
                                    <div style="color:var(--gray); margin:10px 0;"><i class="fa-solid fa-location-dot"></i> ${order.addr}</div>
                                    <button class="btn btn-primary" onclick="acceptJob('${key}')">ACCEPT JOB</button>
                                </div>`;
                        }
                    });
                }
                if(!newCont.innerHTML) newCont.innerHTML = '<div style="text-align:center; padding:20px; color:var(--gray)">No new jobs.</div>';
            });
        }

        // --- ACTIONS ---
        function acceptJob(orderId) {
            // 1. Check KYC
            if (!partnerData || partnerData.kycStatus !== 'verified') {
                alert("⚠️ Please Complete Verification First!");
                openFS('fs-kyc'); // Auto Open KYC Form
                return;
            }

            // 2. Accept Logic
            if(confirm("Accept this job?")) {
                const otp = Math.floor(1000 + Math.random() * 9000); // Generate OTP
                db.ref('orders/' + orderId).update({
                    status: "Accepted",
                    partnerId: currentUser.uid,
                    partnerName: partnerData.name,
                    partnerPhone: partnerData.phone || "Verified Partner",
                    partnerPhoto: currentUser.photoURL,
                    otp: otp // Save OTP to DB (Customer will see this)
                });
            }
        }

        function startJob(orderId) {
            // Ask for OTP from Partner (Customer batayega)
            const enteredOtp = prompt("Ask Customer for OTP & Enter here:");
            if(!enteredOtp) return;

            db.ref('orders/' + orderId + '/otp').once('value', snap => {
                if(snap.val() == enteredOtp) {
                    db.ref('orders/' + orderId).update({ status: "Work Started" });
                    alert("OTP Matched! Work Started.");
                } else {
                    alert("❌ Wrong OTP! Ask customer again.");
                }
            });
        }

        function completeJob(orderId) {
            if(confirm("Mark work as done?")) {
                db.ref('orders/' + orderId).update({ status: "Completed" });
            }
        }

        function submitKYC() {
            const name = document.getElementById('inp-name').value;
            const phone = document.getElementById('inp-phone').value;
            const aadhaar = document.getElementById('inp-aadhaar').value;
            const pan = document.getElementById('inp-pan').value;
            const bank = document.getElementById('inp-bank').value;
            const ifsc = document.getElementById('inp-ifsc').value;

            if(!name || !phone || !aadhaar || !pan || !bank || !ifsc) return alert("Fill all details!");

            const btn = document.getElementById('btn-save-kyc');
            btn.innerText = "Submitting..."; btn.disabled = true;

            db.ref('partners/' + currentUser.uid).update({
                name: name, phone: phone, aadhaar: aadhaar, pan: pan, bank: bank, ifsc: ifsc,
                kycStatus: "pending"
            }).then(() => {
                alert("✅ Verification Submitted!");
                closeFS('fs-kyc');
                btn.innerText = "SUBMIT"; btn.disabled = false;
            });
        }

        // Utils
        function openFS(id) { document.getElementById(id).classList.add('active'); }
        function closeFS(id) { document.getElementById(id).classList.remove('active'); }
        function switchTab(t, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('tab-' + t).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
        }
    </script>
</body>
</html>
